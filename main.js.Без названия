!function(e){var t={};function o(s){if(t[s])return t[s].exports;var i=t[s]={i:s,l:!1,exports:{}};return e[s].call(i.exports,i,i.exports,o),i.l=!0,i.exports}o.m=e,o.c=t,o.d=function(e,t,s){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(o.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)o.d(s,i,function(t){return e[t]}.bind(null,i));return s},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="",o(o.s=0)}([function(e,t,o){o(3),e.exports=o(2)},function(e,t){var o={cookieName:"storytelTrack",cookieValidDays:365,paramList:["fus","fusx"],init:function(){if(!o.getCookie()){var e={refUrl:document.referrer,params:o.lookForParams(),fullUrl:encodeURI(""+window.location)};o.setCookie(e)}},lookForParams:function(){for(var e=""+window.location,t=[],s=0;s<o.paramList.length;s++)e.indexOf(o.paramList[s])>-1&&t.push(getURLParameter(o.paramList[s]));if(0===t.length){-1!==getURLParameter("utm_source").toLowerCase().indexOf("tradedoubler")&&t.push("tradedoubler");var i=document.referrer;i.indexOf("www.google.")>-1&&t.push("google"),t.length<=0&&""===i&&t.push("direct")}return t},setCookie:function(e){setCookieSt(o.cookieName,encodeURIComponent(JSON.stringify(e)),100)},getCookie:function(){var e=decodeURIComponent(getCookie(o.cookieName));return e?JSON.parse(e):null}};o.init()},function(e,t,o){},function(e,t,o){"use strict";o.r(t);o(1);var s=function(){var e=[].slice.call(document.querySelectorAll(".js-lazyImage"));if("IntersectionObserver"in window){let t=new IntersectionObserver((function(e,o){e.forEach((function(e){if(e.isIntersecting){let o=e.target;o.dataset.srcset?o.srcset=o.dataset.srcset:o.src=o.dataset.src,o.classList.remove("js-lazyImage"),t.unobserve(o)}}))}));e.forEach((function(e){t.observe(e)}))}else setTimeout(()=>{e.forEach(e=>{e.dataset.srcset?e.srcset=e.dataset.srcset:e.src=e.dataset.src})},500)};function i(e,t){return(t||document).querySelector(`[id^=${e}]`)}function r(e,t,o,s){e.addEventListener(t,o,!!s)}class n{constructor(e){this.pageNavigationDropdownCheckboxes=e.querySelectorAll(".js-pageNavigationDropdownCheckbox"),this.pageNavigationMenuCheckbox=e.querySelector("#pageNavigationMenuCheckbox"),this.pageNavigationMenuIcon=e.querySelector("#pageNavigationMenuIcon"),this.pageNavigationListContainer=e.querySelector("#pageNavigationListContainer"),this.pageNavigationDropdownLists=e.querySelectorAll(".js-pageNavigationDropdownList");for(const e of this.pageNavigationDropdownCheckboxes)e.addEventListener("change",this.checkboxChangeHandler.bind(this)),e.addEventListener("change",this.hideOpenDropdowns.bind(this));if(this.pageNavigationMenuCheckbox.addEventListener("change",this.toggleBodyScrolling.bind(this)),this.pageNavigationMenuCheckbox.addEventListener("change",this.checkboxChangeHandler.bind(this)),this.pageNavigationMenuCheckbox.addEventListener("change",this.hideOpenDropdowns.bind(this)),this.pageNavigationMenuCheckbox.addEventListener("change",this.toggleMenuCheckboxIcon.bind(this)),this.pageNavigationMenuCheckbox.addEventListener("click",this.addNavigationListSlideOutAnimation.bind(this)),window.addEventListener("scroll",this.changeNavbarColorOnScroll.bind(this,e)),this.pageNavigationMenuCheckbox.addEventListener("change",this.toggleNavbarColorAtTop.bind(this,e)),window.innerWidth>=1200)for(const t of this.pageNavigationDropdownCheckboxes)t.addEventListener("change",this.toggleNavbarColorAtTop.bind(this,e));if(document.querySelector("#logoutPageNavigation")){document.querySelector("#logoutPageNavigation").addEventListener("click",this.logout.bind(this))}}logout(){let e=prependCountryToUri("/logout.action");fetch(e).then(e=>e.json()).then(e=>{"success"===e.result&&(window.location.href=prependCountryToUri("/"))})}checkboxChangeHandler(e){this.toggleCheckedOnCheckbox(e.target),this.toggleAriaExpandedOnCheckbox(e.target)}toggleAriaExpandedOnCheckbox(e){"true"===e.getAttribute("aria-expanded")?e.setAttribute("aria-expanded","false"):e.setAttribute("aria-expanded","true")}toggleCheckedOnCheckbox(e){const t=e.checked;e.setAttribute("checked",!t)}collapseDropdownOnEscape(e,t){27===t.keyCode&&(this.pageNavigationDropdownCheckboxes[e].checked=!1,this.pageNavigationDropdownCheckboxes[e].setAttribute("aria-expanded","false"))}toggleBodyScrolling(){document.querySelector("body").classList.toggle("u-position--isLocked")}hideOpenDropdowns(e){for(const t of this.pageNavigationDropdownCheckboxes)t!==e.target&&(t.checked=!1)}changeNavbarColorOnScroll(e){for(const e of this.pageNavigationDropdownCheckboxes)if(e.checked)return;window.pageYOffset>10?e.classList.add("is-scrolled"):e.classList.remove("is-scrolled")}toggleNavbarColorAtTop(e,t){t.target.checked?e.classList.add("has-changed"):e.classList.remove("has-changed")}toggleMenuCheckboxIcon(){this.pageNavigationMenuIcon.classList.toggle("is-open")}addNavigationListSlideOutAnimation(){this.pageNavigationListContainer.classList.contains("u-animation__transform--ease-in-300")||this.pageNavigationListContainer.classList.add("u-animation__transform--ease-in-300")}}class a{constructor(e){this.footerCountryCheckbox=e.querySelector("#footerCountryCheckbox"),this.footerCountryCheckbox&&(this.footerCountryList=e.querySelector("#footerCountryList"),this.footerCountryListLinks=this.footerCountryList.querySelectorAll(".js-footerCountryListLink"),this.lastFooterCountryListLink=this.footerCountryListLinks[this.footerCountryListLinks.length-1],this.footerCountryCheckbox.addEventListener("change",this.countryCheckboxChangeHandler.bind(this)),window.innerWidth>=1200&&(this.footerCountryList.addEventListener("keydown",this.collapseDropdownOnEscape.bind(this)),this.lastFooterCountryListLink.addEventListener("keydown",this.setFocusTrapForLastCountryListLink.bind(this)),this.footerCountryCheckbox.addEventListener("keydown",this.setFocusTrapForCountryCheckbox.bind(this))))}countryCheckboxChangeHandler(){this.toggleCheckedOnCountryCheckbox(),this.toggleAriaExpandedOnCountryCheckbox()}toggleAriaExpandedOnCountryCheckbox(){"true"===this.footerCountryCheckbox.getAttribute("aria-expanded")?this.footerCountryCheckbox.setAttribute("aria-expanded","false"):this.footerCountryCheckbox.setAttribute("aria-expanded","true")}toggleCheckedOnCountryCheckbox(){const e=this.footerCountryCheckbox.checked;this.footerCountryCheckbox.setAttribute("checked",!e)}collapseDropdownOnEscape(e){27===e.keyCode&&(this.footerCountryCheckbox.checked=!1,this.footerCountryCheckbox.setAttribute("aria-expanded","false"))}setFocusTrapForLastCountryListLink(e){e.shiftKey||9!==e.keyCode||(e.preventDefault(),this.footerCountryCheckbox.focus())}setFocusTrapForCountryCheckbox(e){e.target.checked&&e.shiftKey&&9===e.keyCode&&(e.preventDefault(),this.lastFooterCountryListLink.focus())}}class c{constructor(e){this.bookWallContainers=e.querySelectorAll(".js-bookWallContainer"),this.bookWallContainers.length&&setInterval(()=>{const e=this.getRandomBookCovers();this.isBookCoverHovered(e)||this.swapCoverImage(e)},3e3)}getRandomInt(e,t){return e=Math.ceil(e),t=Math.floor(t),Math.floor(Math.random()*(t-e))+e}getRandomBookCovers(){const e=this.getRandomInt(0,this.bookWallContainers.length);return this.bookWallContainers[e].querySelectorAll(".js-bookWallCover")}isBookCoverHovered(e){const t=e[0],o=e[1];return!(!t.querySelector(":hover")&&!o.querySelector(":hover"))}swapCoverImage(e){const t=e[0],o=e[1];"0"===t.style.opacity?(o.style.opacity="0",o.style.display="none",t.style.opacity="0",t.style.display="flex",t.getClientRects(),t.style.opacity="1"):(t.style.opacity="0",t.style.display="none",o.style.opacity="0",o.style.display="flex",o.getClientRects(),o.style.opacity="1")}}class l{constructor(e){e.querySelector("#bannerButton").addEventListener("click",this.bannerButtonClick.bind(this)),this.bookListContainerEvents(),this.previewModeEnabled()}bookListContainerEvents(){if(null!=campaignPage.querySelectorAll(".bookListContainer")){const e=campaignPage.querySelectorAll(".bookListContainer");for(let t=0;t<e.length;t++){e[t].addEventListener("mouseover",this.bookListContainerAdjustOpactity.bind(e[t])),e[t].addEventListener("mouseout",this.bookListContainerMouseOut.bind(e[t])),e[t].addEventListener("scroll",this.bookListContainerAdjustOpactity.bind(e[t])),e[t].querySelector("div.bookListLeftButton").addEventListener("click",this.bookListLeftClick.bind(e[t])),e[t].querySelector("div.bookListRightButton").addEventListener("click",this.bookListRightClick.bind(e[t]))}}}bookListContainerAdjustOpactity(){const e=this,t=e.scrollWidth-e.clientWidth;e.scrollLeft<t?e.querySelector("div.bookListRightButton").style.opacity="0.8":e.querySelector("div.bookListRightButton").style.opacity="0",e.scrollLeft>0?e.querySelector("div.bookListLeftButton").style.opacity="0.8":e.querySelector("div.bookListLeftButton").style.opacity="0"}bookListContainerMouseOut(){this.querySelector("div.bookListRightButton").style.opacity="0",this.querySelector("div.bookListLeftButton").style.opacity="0"}bookListLeftClick(){this.scrollLeft-=screen.width/2,this.querySelector("div.bookListRightButton").style.opacity="0.8"}bookListRightClick(){this.scrollLeft+=screen.width/2,this.querySelector("div.bookListLeftButton").style.opacity="0.8"}previewModeEnabled(){if("null"!==getURLParameter("preview")){const e=document.querySelectorAll(".js-signUpSubmitButton");for(const t of e)t.disabled=!0}}bannerButtonClick(){campaignPage.querySelectorAll('[id^="signUpForm"]')[0].scrollIntoView({behavior:"smooth",block:"center",inline:"nearest"})}}class d{matchConfirmInput(e,t,o){return e.value!==t.value?(this.showInputError(e),this.showErrorMessage(o),!1):(this.showSuccessIcon(e),!0)}showSuccessIcon(e){e.classList.add("isValid")}hideErrorMessage(e){e.classList.contains("u-display--none")||e.classList.add("u-display--none")}showErrorMessage(e){e.classList.remove("u-display--none")}hideInputError(e){e.classList.remove("hasError")}showInputError(e){e.classList.contains("isValid")&&e.classList.remove("isValid"),e.classList.add("hasError")}clearErrorMessage(e){e.innerHTML=""}insertSubmitErrors(e,t){this.clearErrorMessage(e);for(const[o,s]of Object.entries(t))e.innerHTML+=`<span class="u-display--block">${s}</span>`}}class u{constructor(e){this.formValidator=new d,this.submitErrorContainer=i("submitErrorContainer",e),this.submitErrorMessage=i("submitErrorMessage",e),this.submitButton=i("submitButton",e)}toggleButtonLoading(){this.submitButton.querySelector(".js-submitButtonText").classList.toggle("u-display--none"),this.submitButton.querySelector(".js-submitButtonLoadingIcon").classList.toggle("u-display--none"),this.submitButton.disabled=!this.submitButton.disabled}submitSignUpForm(e,t){this.formValidator.hideErrorMessage(this.submitErrorContainer),this.toggleButtonLoading(),fetch(`${e}?${t}`).then(e=>e.json()).then(e=>{if("success"===e.result||"success"===e.status)authorized=!0,this.redirectUser();else{const{fieldErrors:t}=e;this.formValidator.insertSubmitErrors(this.submitErrorMessage,t),this.formValidator.showErrorMessage(this.submitErrorContainer),this.submitErrorContainer.scrollIntoView({behavior:"smooth",block:"center",inline:"nearest"}),this.toggleButtonLoading()}}).catch((function(e){this.toggleButtonLoading(),console.log(e)}))}redirectUser(){const e=i("signUpForm").getAttribute("data-redirectUrl");window.location=e}}class h{constructor(e){this.modalComponent=i("modalComponent",e),this.closeButton=i("closeButton",e),this.pageOverlay=i("pageOverlay",e),r(this.closeButton,"click",this.closeModal.bind(this))}closeModal(e){e.preventDefault(),this.modalComponent.classList.add("u-display--none"),this.modalComponent.classList.remove("has-privacy-policy"),this.modalComponent.classList.remove("has-user-agreement"),this.pageOverlay.classList.remove("u-display--block"),this.toggleBodyScrolling();const t=document.querySelector("body"),o=t.style.top;t.style.top="",window.scrollTo(0,-1*parseInt(o||"0")),document.querySelector("#pageNavigationComponent").classList.remove("has-changed"),document.querySelector("#pageNavigationComponent").classList.remove("u-display__z-index--1")}openModal(e){this.modalComponent.classList.remove("u-display--none"),this.modalComponent.classList.add(e),this.pageOverlay.classList.add("u-display--block"),document.querySelector("body").style.top="-"+window.scrollY.toString()+"px",this.toggleBodyScrolling(),document.querySelector("#pageNavigationComponent").classList.add("has-changed"),document.querySelector("#pageNavigationComponent").classList.add("u-display__z-index--1")}toggleBodyScrolling(){document.querySelector("body").classList.toggle("u-position--isLocked")}}class g{constructor(e){this.facebookId=0,this.bookId=0,this.formValidator=new d,this.formAction=new u(e),this.modal=new h(e),[this.showPasswordIcon,this.hidePasswordIcon,this.passwordInput,this.emailInput,this.confirmEmailInput,this.confirmPasswordInput,this.confirmEmailErrorMessage,this.confirmPasswordErrorMessage,this.signUpForm,this.agreementCheckbox,this.newsLetterCheckbox,this.facebookButton,this.redirectUrlInput,this.agreementDialogTrigger,this.privacyDialogTrigger,this.campaignCodeInput,this.uniqueCodeInput,this.facebookErrorMessage]=[i("showPasswordIcon",e),i("hidePasswordIcon",e),i("passwordInput",e),i("emailInput",e),i("confirmEmailInput",e),i("confirmPasswordInput",e),i("confirmEmailErrorMessage",e),i("confirmPasswordErrorMessage",e),i("signUpForm",e),i("agreementCheckbox",e),i("newsLetterCheckbox",e),i("facebookButton",e),i("redirectUrlInput",e),i("agreementDialogTrigger ",e),i("privacyDialogTrigger ",e),i("campaignCodeInput ",e),i("uniqueCodeInput ",e),i("facebookErrorMessage",e)],r(this.signUpForm,"submit",this.handleSignUpForm.bind(this)),r(this.agreementDialogTrigger,"click",()=>{this.modal.openModal("has-user-agreement")}),r(this.privacyDialogTrigger,"click",()=>{this.modal.openModal("has-privacy-policy")}),null!==this.confirmPasswordInput.offsetParent&&(r(this.confirmPasswordInput,"blur",()=>this.formValidator.matchConfirmInput(this.confirmPasswordInput,this.passwordInput,this.confirmPasswordErrorMessage)),r(this.confirmPasswordInput,"focus",()=>{this.formValidator.hideInputError(this.confirmPasswordInput),this.formValidator.hideErrorMessage(this.confirmPasswordErrorMessage)})),null===this.confirmPasswordInput.offsetParent&&(r(this.showPasswordIcon,"click",this.togglePasswordVisibility.bind(this,this.hidePasswordIcon,this.showPasswordIcon,this.passwordInput)),r(this.hidePasswordIcon,"click",this.togglePasswordVisibility.bind(this,this.hidePasswordIcon,this.showPasswordIcon,this.passwordInput))),null!==this.confirmEmailInput.offsetParent&&(r(this.confirmEmailInput,"blur",()=>this.formValidator.matchConfirmInput(this.confirmEmailInput,this.emailInput,this.confirmEmailErrorMessage)),r(this.confirmEmailInput,"focus",()=>{this.formValidator.hideInputError(this.confirmEmailInput),this.formValidator.hideErrorMessage(this.confirmEmailErrorMessage)})),this.facebookButton&&r(this.facebookButton,"click",this.handleFacebookSignUp.bind(this))}togglePasswordVisibility(e,t,o){e.classList.contains("u-display--none")?(t.classList.add("u-display--none"),e.classList.remove("u-display--none"),o.type="text"):(e.classList.add("u-display--none"),t.classList.remove("u-display--none"),o.type="password"),o.focus()}getProvidedValue(e){if(globalSignupValues&&globalSignupValues[e])return globalSignupValues[e]}handleSignUpForm(e){e.preventDefault();const t=this.signUpForm.classList.contains("has-two-emails"),o=this.signUpForm.classList.contains("has-two-passwords");if(t){if(!this.formValidator.matchConfirmInput(this.confirmEmailInput,this.emailInput,this.confirmEmailErrorMessage))return}if(o){if(!this.formValidator.matchConfirmInput(this.confirmPasswordInput,this.passwordInput,this.confirmPasswordErrorMessage))return}let s,i,r=this.signUpForm.getAttribute("data-iscampaignform");if(this.referrer=this.getProvidedValue("referrer"),"true"===r){let e,r;e=this.campaignCodeInput?this.campaignCodeInput.value:this.getProvidedValue("campaignCode")||"",this.signUpForm.dataset.redirecturl=updateQueryStringParameter(this.signUpForm.dataset.redirecturl,"campaignCode",e),r=this.uniqueCodeInput?this.uniqueCodeInput.value:this.getProvidedValue("uniqueCode")||"",this.signUpForm.dataset.redirecturl=updateQueryStringParameter(this.signUpForm.dataset.redirecturl,"uniqueCode",r),s=prependCountryToUri("/redeemCampaign.action"),i=new URLSearchParams({email:this.emailInput.value,confirmEmail:t?this.confirmEmailInput.value:this.emailInput.value,password:this.passwordInput.value,confirmPassword:o?this.confirmPasswordInput.value:this.passwordInput.value,acceptMemberAgreement:this.agreementCheckbox.checked,acceptNewsLetterAgreement:!this.newsLetterCheckbox||this.newsLetterCheckbox.checked,campaignCode:e,uniqueCode:r,referrer:this.referrer})}else this.bookId=this.getProvidedValue("book")||0,s=prependCountryToUri("/createAccount.action"),i=new URLSearchParams({email:this.emailInput.value,emailConfirm:t?this.confirmEmailInput.value:this.emailInput.value,pwd:this.passwordInput.value,pwdConfirm:o?this.confirmPasswordInput.value:this.passwordInput.value,acceptMemberAgreement:this.agreementCheckbox.checked,acceptNewsLetterAgreement:!this.newsLetterCheckbox||this.newsLetterCheckbox.checked,fbId:this.facebookId,book:this.bookId,referrer:this.referrer});const n=this.getProvidedValue("fus");n&&(this.signUpForm.dataset.redirecturl=updateQueryStringParameter(this.signUpForm.dataset.redirecturl,"fus",n));const a=this.getProvidedValue("fusx");a&&(this.signUpForm.dataset.redirecturl=updateQueryStringParameter(this.signUpForm.dataset.redirecturl,"fusx",a)),this.formAction.submitSignUpForm(s,i)}handleFacebookSignUp(){this.formValidator.hideErrorMessage(this.facebookErrorMessage),FB.login(e=>{if(console.log("createAccountWithFacebook response",e),"connected"!==e.status)return void this.formValidator.showErrorMessage(this.facebookErrorMessage);const{authResponse:{userID:t,accessToken:o}}=e;this.fetchFacebookUser(t,o)},{scope:"email"})}async fetchFacebookUser(e,t){try{const o=await fetch(`/api/getFacebookUserData.action?socialId=${e}&fbToken=${t}`),s=await o.json();if("success"!==s.result)return void this.formValidator.showErrorMessage(this.facebookErrorMessage);console.log("fetchFacebookUser response",o);const{socialId:i,json:{email:r}}=s;this.facebookId=i,this.emailInput.value=r,this.confirmEmailInput.value=r,this.passwordInput.focus(),this.facebookButton.classList.add("u-display--none")}catch(e){console.log(e),this.formValidator.showErrorMessage(this.facebookErrorMessage)}}}class p{constructor(e){this.seePlansButton=e.querySelector("#seeSubscriptionsButton"),this.pricePlans=e.querySelector("#pricePlans"),this.seePlansButton.addEventListener("click",this.scrollIntoView.bind(this)),window.location.href.includes("#pricePlans")&&this.scrollIntoView()}scrollIntoView(){this.pricePlans.scrollIntoView({behavior:"smooth",block:"center",inline:"nearest"})}}document.addEventListener("DOMContentLoaded",()=>{s();const e=document.querySelector("#footerComponent");e&&new a(e);const t=document.querySelector("#pageNavigationComponent");t&&new n(t);const o=document.querySelector("#bookWallComponent");o&&new c(o);const i=document.querySelector("#signUpComponent");i&&new g(i);const r=document.querySelector("#campaignPage");r&&new l(r);const d=(u="_signUpBlock",(h||document).querySelectorAll(`[id^=${u}]`));var u,h;d&&d.length>0&&d.forEach(e=>{new g(e)});const m=document.querySelector("#subscriptionPage");m&&new p(m);const f=document.querySelector("#familyPage");f&&new p(f)})}]);